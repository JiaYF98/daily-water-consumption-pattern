# 分析日用水规律<br>

## 毕业设计说明：<br>

2022 届环境工程专业本科毕业设计。对监测用水数据进行清洗，根据季节和工作日与否分别得到**日用水规律**，并将得到的规律填充到已有管网模型中以校核模型<br>

## 原始数据说明及思路<br>
### 原始数据
原始数据是分组的，一组中可能有多个监测点位的数据，第一列为时间（记录间隔为 5 分钟），其它列为监测点位流量；<br>
原始数据有大量监测误差，且通常是连续并整日的，大量的误差会使得平均值较正常平均值有较大偏离<br>

### 思路
鉴于原始数据是时间序列和其误差特点，所以采用聚类算法剔除整日或一日中大部分数据是误差的日子，剩余的数据进行常规误差剔除操作

## 代码说明：<br>
通过 **K-Means** 和 **Z-score** 方法的结合以达到清洗数据的目的，清洗后的数据取平均值作为最终日用水规律<br>
1. 使用向前填充和向后填充结合的方式填充空值；<br>
2. 使用 **K-Means** 算法将每日的流量数据分为正常（直观表现为日用水流量图有规律）和不正常（直观表现为日用水流量图无规律）两类，并剔除不正常的数据；<br>
3. 使用 **Z-Score** 方法按照分类标准的不同分别剔除某个时刻不正常的数据；<br>
4. 对正常的数据按照不同分类标准和不同时刻分别取平均值，作为该分类标准该时刻的规律<br>

## 使用说明： <br>
1. 从原始数据中提取出流量数据保存在未筛选数据文件按日拆分中，对应 `split_by_day.py`；
2. 在未筛选数据文件夹中按日绘图确定流量显示范围保存在该文件夹的按日绘图中，对应 `draw_by_day.py`；
3. 在未筛选数据文件夹中按周组合按日拆分的数据保存在该文件夹的按周拆分中，对应 `classify_by_week.py`；
4. 在未筛选数据文件夹中使用按周拆分的数据按周绘图保存在该文件夹的按周绘图中，对应 `draw_by_week.py`；
5. 对于未筛选数据中的按日拆分流量数据，使用 **K-Means** 算法去掉没有规律日期的数据 保存在筛选数据文件夹的按日拆分中，对应 `remove_abnormal_days.py`；
6. 在筛选数据文件夹中，可以通过修改 `draw_by_day.py`, `classify_by_week.py`, `draw_by_week.py` 中的路径，按日、按周绘图以查看聚类去除异常的效果；
7. 对于筛选数据中的按日拆分流量数据，使用 **Z-Score** 方法去除各时刻的异常数据，保存在去除异常数据文件夹中的按日拆分中，对应 `remove_outlier.py`；
8. 在去除异常数据文件夹中可通过绘图查看异常数据去除效果；
9. 对于去除异常数据中的按日拆分流量数据，可按季度和工作日/休息日计算出相应的平均流量数据作为最终规律，保存在平均用水量文件夹中，对应 `get_average.py`；
10. 根据平均用水量中的数据绘图，对应 `draw_average_flow.py`；
11. 利用平均用水量中的数据校核模型，得到相应压力点的压力数据，可以保存到压力对比文件夹，按照组别创建文件夹放好，之后可以绘制对比图，对应 `draw_pressure.py`；
12. 用水时变化系数曲线的绘制可使用 `draw_water_consumption_curve.py` （原用水规律的具体流量没有，用乘数代替）；
13. `handel.py` 中有常用的函数；
14. 后期时间仓促，几个方法中重复代码未处理